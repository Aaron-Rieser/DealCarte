<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deal Posting - Home</title>
    <style>

    </style>
</head>
<body>
    <h1>Welcome to Posters Paradise</h1>
    <button id="detectLocation" class="button">Detect My Location</button>
    <button onclick="window.location.href='post_entry.html'">Create a new post</button>
    <button onclick="window.location.href='post_feed.html'">Find posts near me</button>
    <button id="displayCoordinates" class="button">Display My Coordinates</button>
    <div id="locationInfo"></div>
    <div id="coordinatesInfo"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/turf/5.1.6/turf.min.js"></script>
    <script>
        document.getElementById('detectLocation').addEventListener('click', detectLocation);
        document.getElementById('displayCoordinates').addEventListener('click', displayCoordinates);

        async function detectLocation() {
            const locationInfo = document.getElementById('locationInfo');
            locationInfo.textContent = 'Detecting location...';

            if ('geolocation' in navigator) {
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject);
                    });

                    const response = await fetch('Toronto_New_Neighbourhoods.geojson');
                    const data = await response.json();

                    const userLocation = turf.point([position.coords.longitude, position.coords.latitude]);
                    
                    for (const feature of data.features) {
                        const polygon = turf.polygon(feature.geometry.coordinates);
                        if (turf.booleanPointInPolygon(userLocation, polygon)) {
                            locationInfo.textContent = `Your neighborhood: ${feature.properties.name}`;
                            return;
                        }
                    }
                    
                    locationInfo.textContent = 'Your location is not within any known Toronto neighborhood.';
                } catch (error) {
                    if (error.code === 1) { // PERMISSION_DENIED
                        locationInfo.textContent = 'Location access denied. Please enable location services and try again.';
                    } else {
                        locationInfo.textContent = 'Error detecting location. Please try again.';
                        console.error('Error:', error);
                    }
                }
            } else {
                locationInfo.textContent = 'Geolocation is not supported by your browser.';
            }
        }

        function displayCoordinates() {
            const coordinatesInfo = document.getElementById('coordinatesInfo');
            coordinatesInfo.textContent = 'Fetching coordinates...';

            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const latitude = position.coords.latitude.toFixed(6);
                        const longitude = position.coords.longitude.toFixed(6);
                        coordinatesInfo.textContent = `Your coordinates: ${latitude}, ${longitude}`;
                    },
                    (error) => {
                        if (error.code === 1) { // PERMISSION_DENIED
                            coordinatesInfo.textContent = 'Location access denied. Please enable location services and try again.';
                        } else {
                            coordinatesInfo.textContent = 'Error fetching coordinates. Please try again.';
                            console.error('Error:', error);
                        }
                    }
                );
            } else {
                coordinatesInfo.textContent = 'Geolocation is not supported by your browser.';
            }
        }
    </script>
</body>
</html>